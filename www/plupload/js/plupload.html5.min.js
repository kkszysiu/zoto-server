(function(b){var c=true;function a(i,l,j,d,k){var f,e,h,g;f=document.createElement("canvas");f.style.display="none";document.body.appendChild(f);e=f.getContext("2d");h=new Image();h.onload=function(){var o,m,n;scale=Math.min(l/h.width,j/h.height);if(scale<1){o=Math.round(h.width*scale);m=Math.round(h.height*scale)}else{o=h.width;m=h.height}f.width=o;f.height=m;e.drawImage(h,0,0,o,m);g=f.toDataURL(d);g=g.substring(g.indexOf("base64,")+7);g=atob(g);f.parentNode.removeChild(f);k({success:true,data:g})};h.src=i}b.runtimes.Html5=b.addRuntime("html5",{init:function(h,i){var d={},f;function g(m){var k,j,l=[],n;for(j=0;j<m.length;j++){k=m[j];n=b.guid();d[n]=k;l.push(new b.File(n,k.fileName,k.fileSize))}h.trigger("FilesAdded",l)}function e(){var j;if(window.XMLHttpRequest){j=new XMLHttpRequest();return !!(j.sendAsBinary||j.upload)}return false}if(!e()){i({success:false});return}h.bind("Init",function(k){var q,j=[],l,p,o=k.settings.filters,n,m;q=document.createElement("div");q.id=k.id+"_html5_container";for(l=0;l<o.length;l++){n=o[l].extensions.split(/,/);for(p=0;p<n.length;p++){m=b.mimeTypes[n[p]];if(m){j.push(m)}}}b.extend(q.style,{position:"absolute",background:h.settings.html5_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",opacity:0});q.className="plupload_html5";document.body.appendChild(q);q.innerHTML='<input id="'+h.id+'_html5" style="width:100%;" type="file" accept="'+j.join(",")+'" '+(h.settings.multi_selection?'multiple="multiple"':"")+" />";document.getElementById(h.id+"_html5").onchange=function(){g(this.files);this.value=""}});h.bind("PostInit",function(){var j=document.getElementById(h.settings.drop_element);if(j){b.addEvent(j,"dragover",function(k){k.preventDefault()});b.addEvent(j,"drop",function(l){var k=l.dataTransfer;if(k&&k.files){g(k.files)}l.preventDefault()})}});h.bind("Refresh",function(j){var k,l;k=document.getElementById(h.settings.browse_button);l=b.getPos(k);b.extend(document.getElementById(h.id+"_html5_container").style,{top:l.y+"px",left:l.x+"px",width:k.offsetWidth+"px",height:k.offsetHeight+"px"})});h.bind("UploadFile",function(j,n){var p=new XMLHttpRequest(),m,l=j.settings.url,k=j.settings.resize,o;if(n.status==b.DONE||n.status==b.FAILED||j.state==b.STOPPED){return}if(m=p.upload){m.onload=function(){n.status=b.DONE;j.trigger("FileUploaded",n)};m.onprogress=function(q){n.loaded=q.loaded;j.trigger("UploadProgress",n)}}p.onreadystatechange=function(){if(p.readyState==4){n.status=b.DONE;n.loaded=n.size;j.trigger("UploadProgress",n);j.trigger("FileUploaded",n)}};p.open("post",l+(l.indexOf("?")==-1?"?":"&")+"name="+escape(n.target_name||n.name),true);p.setRequestHeader("Content-Type","application/octet-stream");o=d[n.id];if(p.sendAsBinary){if(k&&/\.(png|jpg|jpeg)$/i.test(n.name)){a(o.getAsDataURL(),k.width,k.height,/\.png$/i.test(n.name)?"image/png":"image/jpeg",function(q){if(q.success){n.size=q.data.length;p.sendAsBinary(q.data)}else{p.sendAsBinary(o.getAsBinary())}})}else{p.sendAsBinary(o.getAsBinary())}}else{p.send(o)}});f=!!(File&&File.prototype.getAsDataURL);h.features={dragdrop:window.mozInnerScreenX!==undefined,jpgresize:f,pngresize:f};i({success:c})}})})(plupload);